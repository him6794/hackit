<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç°¡æ˜“ç¨‹å¼ç·¨è¼¯å™¨</title>
    <style>
        body { font-family: 'Microsoft JhengHei', Arial, sans-serif; line-height: 1.6; margin: 0; padding: 20px; background-color: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background-color: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h2 { color: #2c3e50; margin-bottom: 25px; text-align: center; font-size: 28px; }
        #codeEditor { width: 100%; height: 300px; padding: 15px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: 'Consolas', monospace; font-size: 14px; resize: vertical; background-color: #f8f9fa; transition: border-color 0.3s; }
        #codeEditor:focus { outline: none; border-color: #4CAF50; box-shadow: 0 0 5px rgba(76,175,80,0.2); }
        #runCodeButton { background-color: #4CAF50; color: white; border: none; padding: 12px 25px; border-radius: 5px; cursor: pointer; font-size: 16px; transition: background-color 0.3s; margin: 20px 0; }
        #runCodeButton:hover { background-color: #45a049; }
        #executionResult { background: #2c3e50; color: #ecf0f1; padding: 20px; border-radius: 8px; margin-top: 20px; white-space: pre-wrap; text-align: left; font-family: 'Consolas', monospace; font-size: 14px; min-height: 100px; }
        .loading { opacity: 0.7; pointer-events: none; }
        .intro-section { margin-bottom: 30px; padding: 20px; background-color: #f8f9fa; border-radius: 8px; }
        .syntax-table { width: 100%; border-collapse: collapse; margin-top: 30px; }
        .syntax-table th, .syntax-table td { border: 1px solid #e0e0e0; padding: 10px; text-align: left; }
        .syntax-table th { background-color: #2c3e50; color: white; }
        #inputSection { margin-top: 10px; display: none; }
        #userInput { width: 70%; padding: 8px; border: 2px solid #e0e0e0; border-radius: 5px; font-family: 'Consolas', monospace; }
        #submitInput { background-color: #4CAF50; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-left: 10px; }
        #submitInput:hover { background-color: #45a049; }
    </style>
</head>
<body>
    <div class="container">
        <div class="intro-section">
            <h2>åŸºæœ¬ä»‹ç´¹</h2>
            <p>é€™è£¡æ˜¯åŸºæœ¬ä»‹ç´¹çš„å…§å®¹ï¼Œä½ å¯ä»¥è‡ªè¡Œä¿®æ”¹é€™éƒ¨åˆ†çš„æ–‡å­—ã€‚</p>
            <p>é€™æ˜¯ä¸€å€‹ç°¡å–®çš„ç¨‹å¼ç·¨è¼¯å™¨ç¯„ä¾‹ï¼Œå¯ä»¥ç”¨ä¾†èªªæ˜åŠŸèƒ½èˆ‡ä½¿ç”¨æ–¹å¼ã€‚</p>
        </div>

        <h2>ğŸš€ ç°¡æ˜“ç¨‹å¼ç·¨è¼¯å™¨</h2>
        <textarea id="codeEditor" placeholder="åœ¨æ­¤è¼¸å…¥ç¨‹å¼ç¢¼...
# ä¾‹å¦‚ï¼š
è®€å–ä½¿ç”¨è€…è¼¸å…¥å­—ä¸²ï¼Œä¸¦å„²å­˜è‡³è®Šæ•¸ã€Œinã€ã€‚
è¨­å®šä¸€æŒ‡å®šåç¨±è®Šæ•¸çš„å€¼ï¼Œåç¨±èˆ‡å€¼åˆ†åˆ¥ç‚ºã€Œinã€ï¼Œè®Šæ•¸ã€Œinã€è½‰å‹ã€Œæ•¸å­—ã€ã€‚
åˆå§‹åŒ–ä¸€å€‹æŒ‡å®šåç¨±å’Œé•·åº¦çš„é™£åˆ—ï¼Œåç¨±å’Œé•·åº¦åˆ†åˆ¥ç‚ºã€Œarrã€ï¼Œè®Šæ•¸ã€Œinã€ã€‚
è¨­å®šä¸€æŒ‡å®šåç¨±è®Šæ•¸çš„å€¼ï¼Œåç¨±èˆ‡å€¼åˆ†åˆ¥ç‚ºã€Œiã€ï¼Œ0ã€‚
é‡è¤‡ä¸¦æŒçºŒé©—è­‰å³æ–¹è¡¨é”å¼ä¹‹çœŸå¯¦æ€§ï¼Œæ¢ä»¶æ»¿è¶³æ™‚æŒçºŒåŸ·è¡Œç‰¹å®šæ“ä½œï¼ˆè®Šæ•¸ã€Œiã€è½‰å‹ã€Œæ•¸å­—ã€å°æ–¼è®Šæ•¸ã€Œinã€ï¼‰ã€‚
è¨­å®šæŒ‡å®šåç¨±é™£åˆ—å…¶ä¸­ä¸€é …çš„å€¼ï¼Œåç¨±ã€é …æ•¸èˆ‡å€¼åˆ†åˆ¥ç‚ºã€Œarrã€ï¼Œè®Šæ•¸ã€Œiã€ï¼Œè®Šæ•¸ã€Œiã€ä¹˜ä»¥è®Šæ•¸ã€Œiã€ã€‚
è¨­å®šä¸€æŒ‡å®šåç¨±è®Šæ•¸çš„å€¼ï¼Œåç¨±èˆ‡å€¼åˆ†åˆ¥ç‚ºã€Œiã€ï¼Œè®Šæ•¸ã€Œiã€åŠ ä¸Š1ã€‚
çµæŸä»¥ä¸Šåˆ¤æ–·å¼æˆ–è¿´åœˆã€‚
è¨­å®šä¸€æŒ‡å®šåç¨±è®Šæ•¸çš„å€¼ï¼Œåç¨±èˆ‡å€¼åˆ†åˆ¥ç‚ºã€Œiã€ï¼Œ0ã€‚
é‡è¤‡ä¸¦æŒçºŒé©—è­‰å³æ–¹è¡¨é”å¼ä¹‹çœŸå¯¦æ€§ï¼Œæ¢ä»¶æ»¿è¶³æ™‚æŒçºŒåŸ·è¡Œç‰¹å®šæ“ä½œï¼ˆè®Šæ•¸ã€Œiã€è½‰å‹ã€Œæ•¸å­—ã€å°æ–¼è®Šæ•¸ã€Œinã€ï¼‰ã€‚
å¦‚æœå³æ–¹åˆ¤æ–·å¼çµæœç‚ºçœŸï¼ŒåŸ·è¡Œä»¥ä¸‹ç‰¹å®šæ“ä½œï¼ˆé™£åˆ—ã€Œarrã€çš„ç´¢å¼•ï¼ˆè®Šæ•¸ã€Œiã€ï¼‰ï¼‰å–æ¨¡10ç­‰æ–¼6ã€‚
è¨­å®šä¸€æŒ‡å®šåç¨±è®Šæ•¸çš„å€¼ï¼Œåç¨±èˆ‡å€¼åˆ†åˆ¥ç‚ºã€Œiã€ï¼Œè®Šæ•¸ã€Œiã€åŠ ä¸Š1ã€‚
æ¨æ£„ä»¥ä¸‹è¿´åœˆå…§å®¹ï¼Œç›´æ¥ç¹¼çºŒä¸‹ä¸€è¼ªè¿´åœˆã€‚
çµæŸä»¥ä¸Šåˆ¤æ–·å¼æˆ–è¿´åœˆã€‚
è¦æ±‚åœ¨çµ‚ç«¯æ©Ÿï¼ˆæˆ–æ§åˆ¶å°ï¼‰è¼¸å‡ºé™£åˆ—ã€Œarrã€çš„ç´¢å¼•ï¼ˆè®Šæ•¸ã€Œiã€ï¼‰ã€‚
è¨­å®šä¸€æŒ‡å®šåç¨±è®Šæ•¸çš„å€¼ï¼Œåç¨±èˆ‡å€¼åˆ†åˆ¥ç‚ºã€Œiã€ï¼Œè®Šæ•¸ã€Œiã€åŠ ä¸Š1ã€‚
çµæŸä»¥ä¸Šåˆ¤æ–·å¼æˆ–è¿´åœˆã€‚"></textarea>
        <button id="runCodeButton">åŸ·è¡Œç¨‹å¼ç¢¼ â–¶</button>
        <pre id="executionResult">åŸ·è¡Œçµæœå°‡é¡¯ç¤ºåœ¨é€™è£¡...</pre>
        <div id="inputSection">
            <input type="text" id="userInput" placeholder="è«‹è¼¸å…¥...">
            <button id="submitInput">é€å‡ºè¼¸å…¥</button>
        </div>

        <table class="syntax-table">
            <thead>
                <tr>
                    <th>pythonèªæ³•</th>
                    <th>ACcodeèªæ³•</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>print('hello world')</td>
                    <td>è¦æ±‚åœ¨çµ‚ç«¯æ©Ÿï¼ˆæˆ–æ§åˆ¶å°ï¼‰è¼¸å‡º('hello world')</td>
                </tr>
                <tr>
                    <td>a+b</td>
                    <td>åœ¨åšæ•¸å­—é‹ç®—è¦æ±‚æ•¸å­—è®Šæ•¸a <åŠ ä¸Š> æ•¸å­—è®Šæ•¸b</td>
                </tr>
                <tr>
                    <td>a-b</td>
                    <td>åœ¨åšæ•¸å­—é‹ç®—è¦æ±‚æ•¸å­—è®Šæ•¸a <æ¸›å»> æ•¸å­—è®Šæ•¸b</td>
                </tr>
                <tr>
                    <td>a*b</td>
                    <td>åœ¨åšæ•¸å­—é‹ç®—è¦æ±‚æ•¸å­—è®Šæ•¸a <ä¹˜ä»¥> æ•¸å­—è®Šæ•¸b</td>
                </tr>
                <tr>
                    <td>a/b</td>
                    <td>åœ¨åšæ•¸å­—é‹ç®—è¦æ±‚æ•¸å­—è®Šæ•¸a <é™¤ä»¥> æ•¸å­—è®Šæ•¸b</td>
                </tr>
                <tr>
                    <td>a%b</td>
                    <td>åœ¨åšæ•¸å­—é‹ç®—è¦æ±‚æ•¸å­—è®Šæ•¸a <å–æ¨¡> æ•¸å­—è®Šæ•¸b</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        const runButton = document.getElementById('runCodeButton');
        const editor = document.getElementById('codeEditor');
        const result = document.getElementById('executionResult');
        const inputSection = document.getElementById('inputSection');
        const userInput = document.getElementById('userInput');
        const submitInput = document.getElementById('submitInput');
        let sessionId = null;
    
        // åœ¨ fetch è«‹æ±‚åŠ å…¥ timeout è™•ç†
        const fetchWithTimeout = (url, options, timeout = 10000) => {
            return Promise.race([
                fetch(url, options),
                new Promise((_, reject) =>
                    setTimeout(() => reject(new Error('è«‹æ±‚é€¾æ™‚')), timeout)
                )
            ]);
        }
    
        runButton.addEventListener('click', async () => {
            const code = editor.value;
            runButton.classList.add('loading');
            runButton.textContent = 'åŸ·è¡Œä¸­...';
            result.textContent = 'è™•ç†ä¸­...';
            inputSection.style.display = 'none'; // é è¨­éš±è—è¼¸å…¥æ¡†
    
            try {
                const response = await fetchWithTimeout('/run', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code })
                });
    
                const resultData = await response.json();
                sessionId = resultData.sessionId;
                handleResponse(resultData);
            } catch (error) {
                result.textContent = 'å‰ç«¯è«‹æ±‚éŒ¯èª¤æˆ–é€£ç·šå¤±æ•—ã€‚';
                resetButton();
            }
        });
    
        submitInput.addEventListener('click', async () => {
            const inputValue = userInput.value.trim();
            if (!inputValue || !sessionId) return;
    
            try {
                const response = await fetch('/submit_input', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ sessionId, input: inputValue })
                });
    
                const resultData = await response.json();
                userInput.value = '';  // æ¸…ç©ºè¼¸å…¥æ¡†
                handleResponse(resultData);  // è™•ç†å¾Œç«¯å›æ‡‰
            } catch (error) {
                result.textContent += '\nè¼¸å…¥è™•ç†å¤±æ•—ã€‚';
            }
        });
    
        function handleResponse(data) {
            if (data.output) {
                result.textContent = data.output;
            }
    
            // æ ¹æ“šå¾Œç«¯å›æ‡‰é¡¯ç¤ºæˆ–éš±è—è¼¸å…¥æ¡†
            if (data.needsInput) {
                inputSection.style.display = 'block';
                userInput.focus();  // èšç„¦æ–¼è¼¸å…¥æ¡†
            } else {
                inputSection.style.display = 'none';
                resetButton();
            }
    
            // è™•ç†éŒ¯èª¤
            if (data.error) {
                result.textContent += `\néŒ¯èª¤ï¼š${data.error}`;
                inputSection.style.display = 'none';
                resetButton();
            }
        }
    
        function resetButton() {
            runButton.classList.remove('loading');
            runButton.textContent = 'åŸ·è¡Œç¨‹å¼ç¢¼ â–¶';
            sessionId = null;
        }
    </script>
</body>
</html>
